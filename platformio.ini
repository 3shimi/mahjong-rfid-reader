; PlatformIO 麻將讀牌器專案配置
; 從 Arduino IDE 1.x 遷移至 PlatformIO

[platformio]
description = Mahjong RFID Reader - ESP32 based smart reader with Bluetooth audio
default_envs = esp32dev

[env:esp32dev]
platform = espressif32@6.4.0  ; 使用穩定版本避免相容性問題
board = esp32dev
framework = arduino

; 庫依賴設定
lib_deps = 
    ; RFID 讀取器庫
    miguelbalboa/MFRC522@^1.4.11
    
    ; AudioTools 庫 (ESP32-A2DP 的依賴)
    https://github.com/pschatzmann/arduino-audio-tools.git#v0.9.8
    
    ; ESP32 A2DP 藍牙音訊庫
    https://github.com/pschatzmann/ESP32-A2DP.git
    
    ; SD 卡和 SPI 支援 (Arduino 內建)

; 編譯標誌
build_flags = 
    ; A2DP 相關設定
    -DA2DP_I2S_AUDIOTOOLS=1        ; 啟用 AudioTools A2DP 支援
    -DA2DP_LEGACY_I2S_SUPPORT=1    ; 啟用舊版 I2S 支援 (Arduino 1.x 相容性)
    
    ; 除錯層級 (生產環境建議設為 2 以避免影響音質)
    -DCORE_DEBUG_LEVEL=3
    
    ; 警告抑制 (避免庫相容性警告)
    -Wno-unused-variable
    -Wno-unused-but-set-variable
    -Wno-unused-function
    -Wno-format-extra-args
    
    ; 記憶體最佳化
    -DBOARD_HAS_PSRAM
    -mfix-esp32-psram-cache-issue

; ESP32 記憶體分區 (A2DP 需要更大的程式記憶體)
board_build.partitions = huge_app.csv

; 串列監控設定
monitor_speed = 115200
monitor_filters = 
    esp32_exception_decoder  ; ESP32 例外解碼器
    time                     ; 顯示時間戳記

; 上傳設定
upload_speed = 921600

; 除錯設定 (可選)
debug_tool = esp-prog
debug_init_break = tbreak setup

; 額外腳本 (如需要)
; extra_scripts = post:scripts/copy_data.py